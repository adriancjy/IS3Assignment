<!DOCTYPE html>
<html>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAUS8dqZbJLDz-QblsFM1U8_0_lp6DvgHc&callback=initMap" async defer></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
var markers = [], i;
$(document).ready(function(){
    var nameArray;
    var latArr;
    var lonArr;
	var directionsDisplay = null;
	


function dynamic(URL){
        $.ajax({
  type: "GET",
  url: URL,
  dataType: "xml",
  success: function(xml) {
	var points = [];
    var bounds = new google.maps.LatLngBounds ();
    var count = parseInt($(xml).find('count').text());
    var name = $(xml).find('name').text();
	console.log(name);
	nameArray = [count];
for(var i = 0; i < count; i++){
    var result = name.split(',');
    
    
    //array.push(result[i]);
    nameArray[i] = result[i];
	
}

	
latArr = [count];
lonArr = [count];	
var counter = 0;
	$(xml).find("trkpt").each(function() {
        var lat = parseFloat($(this).attr('lat'));
var lon = parseFloat($(this).attr('lon'));


latArr[counter] = $(this).attr('lat');
lonArr[counter] = $(this).attr('lon');
counter++;


     
    });
	
    var locations = [count];
	console.log(nameArray);
for(var i = 0; i < count; i++){
locations[i] =[
nameArray[i], latArr[i], lonArr[i]
];
}
console.log(locations);

var geocoder;

var directionsService = new google.maps.DirectionsService();

directionsDisplay = new google.maps.DirectionsRenderer({
            suppressMarkers: true,
            suppressInfoWindows: true

       }); 

directionsDisplay.setMap(map);
  var infowindow = new google.maps.InfoWindow();

  
  var request = {
    travelMode: google.maps.TravelMode.WALKING
  };
  for (i = 0; i < locations.length; i++) {
    var marker = new google.maps.Marker({
      position: new google.maps.LatLng(locations[i][1], locations[i][2]),
      map: map
    });
	markers.push(marker);

    google.maps.event.addListener(marker, 'click', (function(marker, i) {
      return function() {
        infowindow.setContent(locations[i][0]);
        infowindow.open(map, marker);
      }
    })(marker, i));
    if (i == 0) request.origin = marker.getPosition();
    else if (i == locations.length - 1) request.destination = marker.getPosition();
    else {
      if (!request.waypoints) request.waypoints = [];
      request.waypoints.push({
        location: marker.getPosition(),
        stopover: true
      });
    }

  }
  directionsService.route(request, function(result, status) {
    if (status == google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(result);
    }
  });

	
  }
});
}

function setMapOnAll(map) {

        for (var i = 0; i < markers.length; i++) {
		markers[i].setPosition(null);
		//console.log(map);
          markers[i].setMap(map);
		  
        }
		directionsDisplay.setMap(null);
		
		
      }

      // Removes the markers from the map, but keeps them in the array.
      function clearMarkers() {
        setMapOnAll(null);
      }
	  
	  function deleteMarkers() {
        clearMarkers();
        markers = [];
      }


$('select').change(function(){
    var value = $('select').val();
	
	if(markers.length != 0){
	deleteMarkers();
	}
    if(value == 'party'){
	dynamic("http://localhost/FuntimeParty.gpx");
    }else if(value == 'stud'){
	dynamic("http://localhost/Students.gpx");
	}else if(value == 'business'){
	dynamic("http://localhost/AfterWorkDrinks.gpx");
	}
	location.href = "#map";
	
    
});
});





    var map;
    function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
              center: {lat: 55.8721, lng: -4.2882},
              zoom: 12
			  
            });
          }
		  
		  window.onscroll = function() {scrollFunction()};

function scrollFunction() {
    if (document.body.scrollTop > 50 || document.documentElement.scrollTop > 50) {
        document.getElementById("myBtn").style.display = "block";
    } else {
        document.getElementById("myBtn").style.display = "none";
    }
}

// When the user clicks on the button, scroll to the top of the document
function topFunction() {
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
}
    </script>
<head>
  
 <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 70%;
		width:100%;
		
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
	  
	  body {
	  background-color:grey;
	  }
	  
	  html {
	scroll-behavior: smooth;
	}
	  
	  #section1 {
		height: 500px;
	  }
	  
	  #myBtn {
  display: none;
  position: fixed;
  bottom: 20px;
  right: 30px;
  z-index: 99;
  font-size: 18px;
  border: none;
  outline: none;
  background-color: red;
  color: white;
  cursor: pointer;
  padding: 15px;
  border-radius: 4px;
}

#myBtn:hover {
  background-color: #555;
}
    </style>
<h1>IS3 - Pub Crawl</h1>
</head>
<div id="section1">
<body>
    <select>
        <option value="" selected disabled hidden>===Select an option===</option>
        <a href="#map"><option value="stud">Student</option></a>
        <option value="party"><a href="#map">Party Animal</a></option>
        <option value="business"><a href="#map">Business Man</a></option>
        
      </select>
	  <a href="#map">Click here</a>
</div>
<div id="map">
</div>
<button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
</body>
</html>